<canvas class="canvas" width="800" height="500"></canvas>
<script>
function getCell(fChenged, fState) {
    return {
        chenged: fChenged,
        state: fState,
        set: function(sChenged, sState) {
            this.chenged = sChenged;
            this.state = sState;
        },
    }
}

function willBeBorn(chance) {
    if (Math.random() * 100 < chance) {
        return true
    }
    return false;
}

function copyArray(from, to) {
    for (var i = 0; i < from.length; i++) {
        to[i] = from[i].slice();
    }
}


var canvas = document.getElementsByClassName('canvas')[0];
var ctx = canvas.getContext('2d');
//0 - nothing, 1 - alive, 2 - death
var nothingNumber = 0;
var aliveNumber = 1;
var deathNumber = 2;
var newAliveNumber = 3;
var nothingColor = '#000';
var aliveColor = '#0F0';
var deathColor = '#00F';
var newAliveColor = "#FF0";
var bornChance = 55;
var rebornChace = 1;
var destroyChance = 7;
var matrix = new Array(300);

console.log(matrix.length);
for (var i1 = 0; i1 < matrix.length; i1++) {
    matrix[i1] = new Array(500);
    for (var i2 = 0; i2 < matrix[i1].length; i2++) {
        matrix[i1][i2] = getCell(true, nothingNumber);
    }
}

matrix[250][400].set(true, newAliveNumber);


function loop() {
    cleanSpace();
    var nextMatrix = [];
    copyArray(matrix, nextMatrix);

    for (var i1 = 0; i1 < matrix.length; i1++) {
        for (var i2 = 0; i2 < matrix[i1].length; i2++) {
        	if (matrix[i1][i2].state === deathNumber && willBeBorn(destroyChance)) {
        		matrix[i1][i2].set(true, nothingNumber);
        	}
            if (matrix[i1][i2].chenged) {
                if (matrix[i1][i2].state === nothingNumber) {
                    ctx.beginPath();
                    ctx.rect(i2, i1, 1, 1);
                    ctx.fillStyle = nothingColor;
                    ctx.fill();
                    ctx.closePath();
                    matrix[i1][i2].chenged = false;
                } else if (matrix[i1][i2].state === deathNumber) {
                    ctx.beginPath();
                    ctx.rect(i2, i1, 1, 1);
                    ctx.fillStyle = deathColor;
                    ctx.fill();
                    ctx.closePath();
                    matrix[i1][i2].chenged = false;
                } else if (matrix[i1][i2].state === aliveNumber) {
                    ctx.beginPath();
                    ctx.rect(i2, i1, 1, 1);
                    ctx.fillStyle = aliveColor;
                    ctx.fill();
                    ctx.closePath();

                    if (willBeBorn(bornChance) && matrix[i1 - 1] != undefined && matrix[i1 - 1][i2].state === nothingNumber) {
                        nextMatrix[i1 - 1][i2].set(true, newAliveNumber);
                    }
                    if (willBeBorn(bornChance) && matrix[i1 + 1] != undefined && matrix[i1 + 1][i2].state === nothingNumber) {
                        nextMatrix[i1 + 1][i2].set(true, newAliveNumber);
                    }
                    if (willBeBorn(bornChance) && matrix[i1][i2 - 1] != undefined && matrix[i1][i2 - 1].state === nothingNumber) {
                        nextMatrix[i1][i2 - 1].set(true, newAliveNumber);
                    }
                    if (willBeBorn(bornChance) && matrix[i1][i2 + 1] != undefined && matrix[i1][i2 + 1].state === nothingNumber) {
                        nextMatrix[i1][i2 + 1].set(true, newAliveNumber);
                    }
                    matrix[i1][i2].set(true, deathNumber);
                } else if (matrix[i1][i2].state === newAliveNumber) {
                	ctx.beginPath();
                    ctx.rect(i2, i1, 1, 1);
                    ctx.fillStyle = newAliveColor;
                    ctx.fill();
                    ctx.closePath();
                    matrix[i1][i2].set(true, aliveNumber);

                }


            }

        }

    }
    console.log(5);

    setTimeout(loop, 10);
}

function cleanSpace() {}


loop();
</script>